<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#111111">
<link rel="manifest" href="manifest.json">
<title>Delivery | Drogaria Rocha</title>

<style>
:root{
  --laranja:#ff6a00;
  --preto:#111;
  --cinza:#f2f2f2;
  --borda:#ddd;
  --ok:#0a8f3c;
  --danger:#b00020;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial;background:var(--cinza)}
header{background:var(--preto);color:#fff;padding:14px}
header span{color:var(--laranja)}
.container{padding:12px;max-width:1100px;margin:auto}
.card{background:#fff;border-radius:10px;padding:14px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.card h3{margin:0 0 10px;border-left:4px solid var(--laranja);padding-left:8px}
input{width:100%;padding:9px;margin:6px 0 10px;border:1px solid var(--borda);border-radius:6px}
button{border:none;border-radius:6px;padding:8px;font-weight:700;cursor:pointer}
.btn-main{background:var(--laranja);color:#fff;width:100%}
.btn-dark{background:var(--preto);color:#fff}
.btn-ok{background:var(--ok);color:#fff}
.btn-danger{background:var(--danger);color:#fff}
.btn-small{font-size:12px;margin:2px}
table{width:100%;border-collapse:collapse}
th{background:var(--preto);color:#fff;padding:8px;font-size:12px}
td{padding:8px;border-bottom:1px solid var(--borda);font-size:12px}
.badge{padding:4px 8px;border-radius:999px;font-size:11px;font-weight:700}
.Aguardando{background:#eee}
.Em\ rota{background:#ffe0c2;color:#b34700}
.Entregue{background:#d4f7d4;color:#006400}
</style>
</head>

<body>
<header>
  <h3>Delivery — <span>Drogaria Rocha</span></h3>
</header>

<div class="container">

<div class="card">
  <h3>Novo Pedido</h3>
  <input type="date" id="data">
  <input id="cliente" placeholder="Cliente">
  <input id="telefone" placeholder="Telefone">
  <input id="pedido" placeholder="Pedido">
  <input id="valor" placeholder="Valor">
  <button class="btn-main" onclick="addPedido()">Adicionar Pedido</button>
</div>

<div class="card">
  <h3>Pedidos de Hoje</h3>
  <table>
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Pedido</th>
        <th>Valor</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="lista"></tbody>
  </table>
</div>

<div class="card">
  <button class="btn-ok" onclick="fecharDia()">Fechar Dia</button>
</div>

<div class="card">
  <h3>Relatório por Período</h3>
  <input type="date" id="ini">
  <input type="date" id="fim">
  <button class="btn-dark" onclick="relatorio()">Gerar Relatório</button>
</div>

</div>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("./service-worker.js");
}

const STORAGE="rocha_delivery_ok";
let pedidos=JSON.parse(localStorage.getItem(STORAGE))||[];

const hoje=()=>new Date().toISOString().split("T")[0];
data.value=hoje();ini.value=hoje();fim.value=hoje();

function salvar(){localStorage.setItem(STORAGE,JSON.stringify(pedidos))}

function addPedido(){
  if(!cliente.value||!pedido.value||!valor.value){alert("Preencha tudo");return;}
  pedidos.push({
    data:data.value,
    cliente:cliente.value,
    telefone:telefone.value,
    pedido:pedido.value,
    valor:valor.value,
    status:"Aguardando"
  });
  cliente.value=telefone.value=pedido.value=valor.value="";
  salvar();render();
}

function excluir(i){pedidos.splice(i,1);salvar();render()}
function statusPedido(i,s){pedidos[i].status=s;salvar();render()}
function fecharDia(){alert("Fechamento realizado.");}

function relatorio(){
  let txt="";
  pedidos.filter(p=>p.data>=ini.value&&p.data<=fim.value)
    .forEach(p=>txt+=`${p.data} | ${p.cliente} | ${p.pedido} | ${p.valor} | ${p.status}\n`);
  const blob=new Blob([txt],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="relatorio.txt";
  a.click();
}

function render(){
  lista.innerHTML="";
  pedidos.filter(p=>p.data===hoje()).forEach((p,i)=>{
    lista.innerHTML+=`
      <tr>
        <td>${p.cliente}</td>
        <td>${p.pedido}</td>
        <td>${p.valor}</td>
        <td><span class="badge ${p.status}">${p.status}</span></td>
        <td>
          <button class="btn-small btn-dark" onclick="statusPedido(${i},'Em rota')">Rota</button>
          <button class="btn-small btn-dark" onclick="statusPedido(${i},'Entregue')">Entregue</button>
          <button class="btn-small btn-danger" onclick="excluir(${i})">Excluir</button>
        </td>
      </tr>`;
  });
}
render();
</script>

</body>
</html>
